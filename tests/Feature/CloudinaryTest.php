<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

class CloudinaryTest extends TestCase
{
    //use RefreshDatabase;
    /**
     * A basic test example.
     *
     * @return void
     */
    public function testUpload()
    {
        $response = $this->json('POST', '/callback/admin/photo/upload', json_decode('{"public_id":"fszhtinfpc9f5zmjez1f","version":1508172128,"width":2048,"height":1176,"format":"jpg","resource_type":"image","created_at":"2017-10-16T16:42:08Z","tags":[],"pages":1,"bytes":374401,"type":"upload","etag":"bd1ea4b60e478d8a87088c020311f105","placeholder":false,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/v1508172128/fszhtinfpc9f5zmjez1f.jpg","context":{"custom":{"album_id":"1"}},"image_metadata":{"JFIFVersion":"1.01","ResolutionUnit":"inches","XResolution":"72","YResolution":"72","ProfileDescription":"sRGB IEC61966-2.1","Colorspace":"RGB","DPI":"72"},"coordinates":{"faces":[]},"illustration_score":0.6529868841171265,"semi_transparent":false,"grayscale":false,"original_filename":"36500615336_9e44f16e57_k","eager":[{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_2048/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_2048/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1600/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1600/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1024/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1024/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_800/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_800/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_640/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_640/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_200,w_200/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_200,w_200/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"status":"processing","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8","url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_500,w_500/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_500,w_500/v1508172128/fszhtinfpc9f5zmjez1f.jpg"}],"notification_type":"upload"}', true));
        $this->assertDatabaseHas('photos', ['cloudinary_public_id' => 'fszhtinfpc9f5zmjez1f', 'album_id' => 1]);
        
   
    }
    public function testTransform()
    {
        $array = json_decode('{"notification_type":"eager","eager":[{"transformation":"c_limit,h_5000,q_auto:best,w_2048","width":2048,"height":1176,"bytes":302430,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_2048/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_2048/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_limit,h_5000,q_auto:best,w_1600","width":1600,"height":919,"bytes":190433,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1600/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1600/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_limit,h_5000,q_auto:best,w_1024","width":1024,"height":588,"bytes":98230,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1024/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_1024/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_limit,h_5000,q_auto:best,w_800","width":800,"height":459,"bytes":63026,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_800/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_800/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_limit,h_5000,q_auto:best,w_640","width":640,"height":368,"bytes":45269,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_640/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_limit,h_5000,q_auto:best,w_640/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_fill,g_auto,h_200,w_200","width":200,"height":200,"bytes":11833,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_200,w_200/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_200,w_200/v1508172128/fszhtinfpc9f5zmjez1f.jpg"},{"transformation":"c_fill,g_auto,h_500,w_500","width":500,"height":500,"bytes":34922,"url":"http://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_500,w_500/v1508172128/fszhtinfpc9f5zmjez1f.jpg","secure_url":"https://res.cloudinary.com/mazui-gallery/image/upload/c_fill,g_auto,h_500,w_500/v1508172128/fszhtinfpc9f5zmjez1f.jpg"}],"public_id":"fszhtinfpc9f5zmjez1f","batch_id":"887b5017c18234f2d61117c3f5359419e70a55da7a7e004ce0f84dcbd3f5010aaed986c0eebeebe7f594bb37b1716dc8"}', true);
        $response = $this->json('POST', 'callback/admin/photo/transform', $array);
        $this->assertDatabaseHas('media', ['public_id' => 'fszhtinfpc9f5zmjez1f', 'width' => 2048, 'height' => 1176]);
          
    }
}
